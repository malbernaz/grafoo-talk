import { Head, Image } from "mdx-deck"
import Cowsay from "react-cowsay"
import Logo from "./Logo"
import Me from "./Me"
import { theme, PINK } from "./config"
import { SimpleRequest, CodeLayout, GQL, GQLExec, endSay } from "./code"
import { Split } from "mdx-deck/layouts"

export { theme }

<Head>
  <title>Grafoo: a anatomia de um cliente GraphQL</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" />
  <style>{`
    code { background: white !important; }
    pre, strong { color: ${PINK} }
  `}</style>
</Head>

<Logo />

_a anatomia de um cliente GraphQL_

---

## Quem sou eu?

<Me />

<br />
<br />
<small>
  <strong>email:</strong> albernazmiguel@gmail.com
</small>
<br />
<small>
  <strong>twitter:</strong> @miguel_albernaz
</small>
<br />
<small>
  <strong>github:</strong> @malbernaz
</small>

---

## GraphQL

Uma linguagem de query para APIs e um runtime para resolver essas queries com os seus dados.

---

<GQL />

---

## O que é um cliente de GraphQL?

Um cliente GraphQL atua junto a sua API GraphQL, executando `queries` e `mutations` que expressam a sua necessidade de dados e recebem como resposta um JSON com as informacões requisitadas.

---

## Tipos de clientes

Podemos diferenciar dois tipos de clientes GraphQL. Os mais simples, que realizam a simples tarefa de se comunicar com a sua API e os que a isto somam um sistema de caching e/ou ferramentas para manter consistente o estado.

---

## Clientes simples

<SimpleRequest />

export default CodeLayout

---

## Clientes complexos

Os clientes mais avançados existem com o propósito de otimizar a comunicação com a sua API; têm utilidades para manejar o estado e tentam aproveitar ao máximo os beneficios que o GraphQL oferece no frontend.

---

## Anatomia de um cliente GraphQL

Clientes GraphQL complexos são compostos de basicamente três partes:

---

## Transporte

Basicamente transporte é como o seu cliente se comunica com a sua API. Pode-se dizer que é um cliente por sí só (simples), sendo responsável por requisitar e/ou executar as suas queries.

---

## Cache

Pense no cache como uma store que armazena os resultados das suas queries de maneira normalizada; idealmente mapeados por um ID único para que se mantenha o estado consistente.

---

## Integrações

Significa como o cliente se integra com determinado framework; de maneira geral componentes, ou interfaces.

---

## Grafoo

É um cliente GraphQL para todos os propósitos que foi criado com enfoque em **simplicidade**, **usabilidade** e **performance**.

---

## Como Funciona?

A biblioteca funciona com a premissa de que todos os nós do seu grafo possam ser armazenados por um ID único. Então aproveitando a análise estática que o GraphQL permite, todas as queries da aplicação são compiladas em tempo de build para que sejam incluidos um campo ou mais que possam servir como identificador.

---

## Transporte

É interessante resaltar que o GraphQL não é uma tecnologia estritamente para servidores. Com o Grafoo não é diferente. Qualquer função que retorne uma promise com o resultado de uma execução de query é um transporte.

---

<SimpleRequest />

export default CodeLayout

---

<GQLExec />

export default CodeLayout

---

## Cache

Durante o tempo de execução os resultados das queries junto a nossa API são armazenados de duas maneiras:

---

## Mapa de paths

Em formato de árvore para armazenar a estrutura desse resultado

---

<img src="./querytree.svg" />

---

## Mapa de objectos

E em formato plano para armazenar cada objeto por um ID único para mantendo o controle sobre quais objetos vão ser nessessários para construir o resultado de uma determinada query

---

<img src="objectmap.svg" style={{ width: "100%", padding: "1rem" }} />

---

## Integrações

demo

---

## Referência:

<br />
<small>
  <strong>How to Graphql:</strong>{" "}
  <a href="https://bit.ly/2PM69yW">https://bit.ly/2PM69yW</a>
</small>
<br />
<br />
<small>
  <strong>GraphQL Concepts Visualized - Dhaivat Pandya:</strong>{" "}
  <a href="https://bit.ly/2okscA7">https://bit.ly/2okscA7</a>
</small>
<br />
<br />
<small>
  <strong>Empezando con Relay - Belén Cursio:</strong>{" "}
  <a href="https://bit.ly/2oigxlk">https://bit.ly/2oigxlk</a>
</small>

---

<strong>
  <Cowsay d>
    Fim...
  </Cowsay>
</strong>
